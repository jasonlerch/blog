<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>digressions on (mouse) brain imaging</title>
<link>https://users.ox.ac.uk/~ndcn0890/index.html</link>
<atom:link href="https://users.ox.ac.uk/~ndcn0890/index.xml" rel="self" type="application/rss+xml"/>
<description>(mouse) brain imaging and statistics</description>
<generator>quarto-1.3.353</generator>
<lastBuildDate>Sun, 26 Nov 2023 00:00:00 GMT</lastBuildDate>
<item>
  <title>Developmental analyses, part 1</title>
  <dc:creator>Jason Lerch</dc:creator>
  <link>https://users.ox.ac.uk/~ndcn0890/posts/developmental-data/index.html</link>
  <description><![CDATA[ 




<p>Longitudinal data provides its own set of modelling challenges. These primarily concern how to model time, especially if there is a curvilinear relationship between time and variable(s) of interest. A related issue is making statistical models not only fit the data well but also produce interpretable output that helps address questions of changes in baseline alongside changes in trajectories.</p>
<p>This will be a series of posts, exploring:</p>
<ol type="1">
<li>Plotting of longitudinal data</li>
<li>Fitting straight lines and interpreting slopes and intercepts</li>
<li>Fitting curves via splines</li>
<li>Comparisons between different fitted models for ease of interpretation</li>
<li>Segmented models</li>
<li>General additive models</li>
<li>Random intercepts and random slopes</li>
<li>Bayesian linear models</li>
<li>RMINC and data.tree methods to explore all these across the brain</li>
</ol>
<p>For this first post we’ll look at points 1-4 with small bits of RMINC and data.tree creeping in.</p>
<p>To explore these questions we will use data being collected by Tiffany Chien, where she is looking at the effect of maternal auto-antibodies on brain development in mice. Each mouse was imaged at eight different timepoints, following a pattern set <a href="https://www.nature.com/articles/s41467-018-04921-2">here</a> and first developed <a href="https://pubmed.ncbi.nlm.nih.gov/26037053/">here</a>. We begin by loading the data as provided by Tiffany:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(data.tree)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
✔ ggplot2 3.4.2     ✔ purrr   1.0.1
✔ tibble  3.2.1     ✔ dplyr   1.1.2
✔ tidyr   1.3.0     ✔ stringr 1.5.0
✔ readr   2.1.3     ✔ forcats 0.5.2
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">load</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"brain_analysis_data_2023nov2.RData"</span>)</span></code></pre></div>
</div>
<p>This contains 5 items - the anatomy and labels volumes, the dataframe describing each scan (gf), a matrix of structure volumes (structvols), and the label definitions (hdefs).</p>
<p>We can then add the volumes to the hierarchical anatomy, since anatomical hierarchies are awesome.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(RMINC)</span>
<span id="cb4-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># the suppress warnings bit deals with a comparison in the data.tree</span></span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># library that throws far too many warnings.</span></span>
<span id="cb4-4">hvols <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">suppressWarnings</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addVolumesToHierarchy</span>(hdefs, structvols))</span></code></pre></div>
</div>
<p>Let’s start with overall brain volumes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">gf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>brainVols <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> hvols<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>volumes</span></code></pre></div>
</div>
<p>And plot them, initially by sex, since we have some decently strong expectations of the development of sex differences in the brain.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set some defaults for ggplots for the rest of the document</span></span>
<span id="cb6-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>())</span>
<span id="cb6-6">scale_colour_brewer_d <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(...) {</span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_colour_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set1"</span>, ...)</span>
<span id="cb6-8">}</span>
<span id="cb6-9"></span>
<span id="cb6-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ggplot2.discrete.colour=</span>scale_colour_brewer_d)</span>
<span id="cb6-11"></span>
<span id="cb6-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(gf) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>age, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>brainVols, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour=</span>Sex) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bquote</span>(Volume <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> (mm<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Brain volume"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="https://users.ox.ac.uk/~ndcn0890/posts/developmental-data/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This is a fairly standard ggplot plot. geom_smooth does a lot of the heavy lifting here. By default it uses a local estimator (loess) to fit the curve; these are great for visualization but not so useful for analyses. It also shows a clear overall pattern of rapid growth in brain volume until around day 20, followed by slower growth.</p>
<p>Brain volume does not appear particularly different by sex, which is what we have seen before. Since we are looking at sex let’s pick a classically dimorphic brain structure</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(gf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-2">         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MeA =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FindNode</span>(hvols, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Medial amygdalar nucleus"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>volumes)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>age, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>MeA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour=</span>Sex) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb8-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bquote</span>(Volume <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> (mm<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb8-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Medial Amygdala"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="https://users.ox.ac.uk/~ndcn0890/posts/developmental-data/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>OK, we have sensible patterns, showing larger volumes of the medial amygdala in males, seemingly emerging over the first few days of life. Let’s improve the plot a little bit to let us see what happens to individual mice. First, let’s plot each mouse entirely separately.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(gf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-2">         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MeA =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FindNode</span>(hvols, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Medial amygdalar nucleus"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>volumes)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>age, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>MeA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour=</span>Sex) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bquote</span>(Volume <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> (mm<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Medial Amygdala"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb10-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>subject_id)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_line()`: Each group consists of only one observation.
ℹ Do you need to adjust the group aesthetic?
`geom_line()`: Each group consists of only one observation.
ℹ Do you need to adjust the group aesthetic?
`geom_line()`: Each group consists of only one observation.
ℹ Do you need to adjust the group aesthetic?</code></pre>
</div>
<div class="cell-output-display">
<p><img src="https://users.ox.ac.uk/~ndcn0890/posts/developmental-data/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note that I’ve replaced the fitting (<code>geom_smooth</code>) with a simpler line (<code>geom_line</code>). A few features immediately stand out from this plot: quite a few mice only have a few data points, which is primarily due to data collection being ongoing, and there are too many mice for this plot to be terribly useful. Let’s instead plot separate lines on the same plot as before:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(gf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-2">         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MeA =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FindNode</span>(hvols, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Medial amygdalar nucleus"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>volumes)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>age, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>MeA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour=</span>Sex) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb12-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb12-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb12-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group=</span>subject_id), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb12-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bquote</span>(Volume <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> (mm<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb12-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Medial Amygdala"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="https://users.ox.ac.uk/~ndcn0890/posts/developmental-data/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Not always clear how useful such a plot is, but it sure is pretty. Note that the <code>geom_line</code> bit needed to have the <code>group</code> specified in order for ggplot to know which points to join up with lines.</p>
<p>On to statistics. For the sake of argument let’s go with the simplest model of volume against age by sex:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">suppressMessages</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(lmerTest))</span>
<span id="cb14-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create a new variable for the medial amygdala for easier access</span></span>
<span id="cb14-3">gf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MeA =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">FindNode</span>(hvols, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Medial amygdalar nucleus"</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>volumes)</span>
<span id="cb14-5"></span>
<span id="cb14-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># run the linear mixed effects model.</span></span>
<span id="cb14-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lmer</span>(MeA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> age <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> Sex <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>subject_id), gf))</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>boundary (singular) fit: see help('isSingular')</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: MeA ~ age * Sex + (1 | subject_id)
   Data: gf

REML criterion at convergence: -362.9

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.6383 -0.7678  0.0283  0.7920  3.6123 

Random effects:
 Groups     Name        Variance Std.Dev.
 subject_id (Intercept) 0.000000 0.0000  
 Residual               0.009781 0.0989  
Number of obs: 224, groups:  subject_id, 37

Fixed effects:
             Estimate Std. Error        df t value Pr(&gt;|t|)    
(Intercept) 5.125e-01  1.425e-02 2.200e+02  35.967   &lt;2e-16 ***
age         7.674e-03  4.859e-04 2.200e+02  15.794   &lt;2e-16 ***
SexM        5.855e-03  1.942e-02 2.200e+02   0.302   0.7633    
age:SexM    1.717e-03  6.762e-04 2.200e+02   2.539   0.0118 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
         (Intr) age    SexM  
age      -0.739              
SexM     -0.734  0.542       
age:SexM  0.531 -0.719 -0.731
optimizer (nloptwrap) convergence code: 0 (OK)
boundary (singular) fit: see help('isSingular')</code></pre>
</div>
</div>
<p>Here we use a linear mixed effects model. These models are the bread and butter of longitudinal analyses, as they allow you to account for the dependence created by having multiple datapoints from the same subject. There are multiple ways to specify these models, with the main decisions revolving around what fixed effects and what random effects to use. Fixed effects are what you would use in any old linear model; here we specify an age by sex interaction. Random effects, the bits inside the parentheses, determine how to treat the individual mice in this dataset. Here we use the simplest formula, (1 | id), which allows every mouse to have a separate intercept but not a separate slope. I.e. at baseline mouse 1 can have a larger or smaller volume than mouse 2, but from then on the effect of age will be the same for all mice. We could allow for separate slopes too, a topic which we will explore in a future post.</p>
<p>We also get warnings about singular fits - these are due to no variance in the random intercept (i.e.&nbsp;the separate intercept per subject) being identified. This can be indicative of a real problem and the need to change the model formula, but in simple cases like this <a href="https://bbolker.github.io/mixedmodels-misc/glmmFAQ.html#singular-models-random-effect-variances-estimated-as-zero-or-correlations-estimated-as---1">can be ignored for now</a>.</p>
<p>Onto the results. Our model shows an effect of age and an age by sex interaction, but no effect of sex. Why is that? Two reasons:</p>
<ol type="1">
<li>We are fitting a straight line, where there clearly is a curve in the data</li>
<li>We are testing the effect of sex at age=0, which doesn’t make sense.</li>
</ol>
<p>Let’s look at them in turn. Plotting as a straight line:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(gf) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb17-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>age, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>MeA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour=</span>Sex) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb17-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb17-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula=</span>y<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb17-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bquote</span>(Volume <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> (mm<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb17-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Medial Amygdala"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://users.ox.ac.uk/~ndcn0890/posts/developmental-data/index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>First, it’s evident that the model does not fit all that well, which is to be expected since we saw earlier that a straight line is not the right way to model age. Second, we can see the interaction - the lines are not parallel. Third, at age=0 the lines overlap.</p>
<p>Tackling the third point first, in a linear model with an interaction, each term of an interaction is interpreted at the zero point of the other term. Going back to the linear model output from above, it’s telling us that age=0 the females (the reference level of sex) have a volume of 5.125e-01 (the intercept), and males a volume of 5.125e-01 + 5.855e-03. If we change where the intercept falls we change these values. To whit, let’s test at an age of 65:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lmer</span>(MeA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> age <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> Sex <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>subject_id), gf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age =</span> age<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-65</span>)))</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>boundary (singular) fit: see help('isSingular')</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: MeA ~ age * Sex + (1 | subject_id)
   Data: gf %&gt;% mutate(age = age - 65)

REML criterion at convergence: -362.9

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.6383 -0.7678  0.0283  0.7920  3.6123 

Random effects:
 Groups     Name        Variance Std.Dev.
 subject_id (Intercept) 0.000000 0.0000  
 Residual               0.009781 0.0989  
Number of obs: 224, groups:  subject_id, 37

Fixed effects:
             Estimate Std. Error        df t value Pr(&gt;|t|)    
(Intercept) 1.011e+00  2.315e-02 2.200e+02  43.693  &lt; 2e-16 ***
age         7.674e-03  4.859e-04 2.200e+02  15.794  &lt; 2e-16 ***
SexM        1.175e-01  3.256e-02 2.200e+02   3.607 0.000383 ***
age:SexM    1.717e-03  6.762e-04 2.200e+02   2.539 0.011796 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
         (Intr) age    SexM  
age       0.910              
SexM     -0.711 -0.647       
age:SexM -0.654 -0.719  0.914
optimizer (nloptwrap) convergence code: 0 (OK)
boundary (singular) fit: see help('isSingular')</code></pre>
</div>
</div>
<p>I changed age by subtracting 65 from it, so now the intercept (age=0) is really age=65. Now the SexM term has become quite significant; look back at the plot above and see how the two lines diverge significantly at that age. At age 65 the females have a volume 1.01, and males 1.01 + 0.11.</p>
<section id="fitting-curves-in-linear-models" class="level3">
<h3 class="anchored" data-anchor-id="fitting-curves-in-linear-models">Fitting curves in linear models</h3>
<p>Now back to the fact that the data should not be fit with a straight line since there is a clearly detectable curve in the relation between volume and age. Let’s use a third order spline:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(splines)</span>
<span id="cb21-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(gf) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb21-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>age, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>MeA, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour=</span>Sex) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb21-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb21-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula=</span>y<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ns</span>(x,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb21-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bquote</span>(Volume <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> (mm<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb21-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Medial Amygdala"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://users.ox.ac.uk/~ndcn0890/posts/developmental-data/index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here I changed the bit inside <code>geom_smooth</code>. First, using the <code>method="lm"</code> syntax I told it to use a linear model rather than a local estimator, and then I gave it the formula. The <code>ns(age, 3)</code> syntax tells it to use a natural spline with 3 degrees of freedom.</p>
<p>That fits pretty well. Let’s look at the model outputs</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lmer</span>(MeA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ns</span>(age,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> Sex <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>subject_id), gf))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: MeA ~ ns(age, 3) * Sex + (1 | subject_id)
   Data: gf

REML criterion at convergence: -684.5

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.4337 -0.5530  0.1326  0.5837  4.8808 

Random effects:
 Groups     Name        Variance Std.Dev.
 subject_id (Intercept) 0.000588 0.02425 
 Residual               0.001906 0.04366 
Number of obs: 224, groups:  subject_id, 37

Fixed effects:
                  Estimate Std. Error        df t value Pr(&gt;|t|)    
(Intercept)      4.357e-01  1.200e-02 1.420e+02  36.326  &lt; 2e-16 ***
ns(age, 3)1      4.611e-01  2.098e-02 1.873e+02  21.977  &lt; 2e-16 ***
ns(age, 3)2      6.464e-01  2.463e-02 1.898e+02  26.238  &lt; 2e-16 ***
ns(age, 3)3      3.878e-01  1.304e-02 1.856e+02  29.730  &lt; 2e-16 ***
SexM             3.758e-03  1.596e-02 1.356e+02   0.235 0.814249    
ns(age, 3)1:SexM 5.144e-02  2.931e-02 1.895e+02   1.755 0.080902 .  
ns(age, 3)2:SexM 1.110e-01  3.287e-02 1.893e+02   3.378 0.000888 ***
ns(age, 3)3:SexM 7.340e-02  1.833e-02 1.860e+02   4.005 8.94e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr) ns(,3)1 ns(,3)2 ns(,3)3 SexM   n(,3)1: n(,3)2:
ns(age, 3)1 -0.002                                               
ns(age, 3)2 -0.782 -0.029                                        
ns(age, 3)3 -0.193  0.167   0.314                                
SexM        -0.751  0.002   0.587   0.145                        
ns(g,3)1:SM  0.002 -0.716   0.021  -0.120  -0.002                
ns(g,3)2:SM  0.586  0.022  -0.749  -0.235  -0.766 -0.030         
ns(g,3)3:SM  0.137 -0.119  -0.223  -0.712  -0.178  0.151   0.311 </code></pre>
</div>
</div>
<p>Now we have a much harder to interpret set of age terms (and their interactions). Each of the <code>ns(age, 3)1</code> or <code>ns(age, 3)2</code> or <code>ns(age, 3)3</code> tells us about the parameters of the different spline terms. While these can obviously be used to reconstruct the fit, in practice they are essentially uninterpretable for figuring out where and how the age trajectories deviate by sex.</p>
<p>But looking at just the sex terms, it’s again insignificant at age=0. Let’s see at age 65.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lmer</span>(MeA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ns</span>(age,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> Sex <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>subject_id), gf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age=</span>age<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-65</span>)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: MeA ~ ns(age, 3) * Sex + (1 | subject_id)
   Data: gf %&gt;% mutate(age = age - 65)

REML criterion at convergence: -684.5

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.4337 -0.5530  0.1326  0.5837  4.8808 

Random effects:
 Groups     Name        Variance Std.Dev.
 subject_id (Intercept) 0.000588 0.02425 
 Residual               0.001906 0.04366 
Number of obs: 224, groups:  subject_id, 37

Fixed effects:
                  Estimate Std. Error        df t value Pr(&gt;|t|)    
(Intercept)      4.357e-01  1.200e-02 1.420e+02  36.326  &lt; 2e-16 ***
ns(age, 3)1      4.611e-01  2.098e-02 1.873e+02  21.977  &lt; 2e-16 ***
ns(age, 3)2      6.464e-01  2.463e-02 1.898e+02  26.238  &lt; 2e-16 ***
ns(age, 3)3      3.878e-01  1.304e-02 1.856e+02  29.730  &lt; 2e-16 ***
SexM             3.758e-03  1.596e-02 1.356e+02   0.235 0.814249    
ns(age, 3)1:SexM 5.144e-02  2.931e-02 1.895e+02   1.755 0.080902 .  
ns(age, 3)2:SexM 1.110e-01  3.287e-02 1.893e+02   3.378 0.000888 ***
ns(age, 3)3:SexM 7.340e-02  1.833e-02 1.860e+02   4.005 8.94e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr) ns(,3)1 ns(,3)2 ns(,3)3 SexM   n(,3)1: n(,3)2:
ns(age, 3)1 -0.002                                               
ns(age, 3)2 -0.782 -0.029                                        
ns(age, 3)3 -0.193  0.167   0.314                                
SexM        -0.751  0.002   0.587   0.145                        
ns(g,3)1:SM  0.002 -0.716   0.021  -0.120  -0.002                
ns(g,3)2:SM  0.586  0.022  -0.749  -0.235  -0.766 -0.030         
ns(g,3)3:SM  0.137 -0.119  -0.223  -0.712  -0.178  0.151   0.311 </code></pre>
</div>
</div>
<p>The model terms haven’t changed. So with splines we’ve lost the ability to interpret our data quite the way we want by moving the intercept; other spline parameterizations than natural splines can do better, and polynomials can do it very well, but ultimately we want a more general solution. The <a href="https://github.com/rvlenth/emmeans">emmeans</a> package to the rescue for estimated marginal means.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(emmeans)</span>
<span id="cb26-2">l <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lmer</span>(MeA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ns</span>(age,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> Sex <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>subject_id), gf)</span>
<span id="cb26-3">e <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">emmeans</span>(l, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Sex <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> age, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">at =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span>)))</span></code></pre></div>
</div>
<p>First, we fitted a linear mixed effects model as before, and then we’ve computed the marginal means using the <code>emmeans</code> function from the package of the same name. The first argument is the model, then it’s the formula; here we tell it that we want to evaluate Sex across age. Next we tell the <code>emmeans</code> function to evaluate its output at 3 different ages - 7, 21, and 65. We can look at the output:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">e</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>age =  7:
 Sex emmean      SE    df lower.CL upper.CL
 F    0.525 0.00863  56.6    0.508    0.543
 M    0.547 0.00807  56.0    0.531    0.563

age = 21:
 Sex emmean      SE    df lower.CL upper.CL
 F    0.766 0.00908  65.2    0.748    0.784
 M    0.820 0.00866  71.0    0.802    0.837

age = 65:
 Sex emmean      SE    df lower.CL upper.CL
 F    0.911 0.01320 172.9    0.885    0.937
 M    1.006 0.01310 184.7    0.980    1.032

Degrees-of-freedom method: kenward-roger 
Confidence level used: 0.95 </code></pre>
</div>
</div>
<p>This is already quite useful, as we can get the estimated means at those three ages for each sex, alongside their 95% confidence intervals. But we can go further and compute the differences at those ages explicitly:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pairs</span>(e)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>age =  7:
 contrast estimate     SE    df t.ratio p.value
 F - M     -0.0216 0.0118  56.4  -1.832  0.0722

age = 21:
 contrast estimate     SE    df t.ratio p.value
 F - M     -0.0538 0.0125  67.9  -4.289  0.0001

age = 65:
 contrast estimate     SE    df t.ratio p.value
 F - M     -0.0951 0.0186 178.8  -5.115  &lt;.0001

Degrees-of-freedom method: kenward-roger </code></pre>
</div>
</div>
<p>We can tell from this output that sex differences are borderline at age 7, and become quite strikingly significant later. Note that the contrast is the reverse of what we would expect from our linear model; we can reverse that in turn:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pairs</span>(e, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reverse =</span> T)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>age =  7:
 contrast estimate     SE    df t.ratio p.value
 M - F      0.0216 0.0118  56.4   1.832  0.0722

age = 21:
 contrast estimate     SE    df t.ratio p.value
 M - F      0.0538 0.0125  67.9   4.289  0.0001

age = 65:
 contrast estimate     SE    df t.ratio p.value
 M - F      0.0951 0.0186 178.8   5.115  &lt;.0001

Degrees-of-freedom method: kenward-roger </code></pre>
</div>
</div>
<p>As a way of comparison, let’s get back to overall brain volume, which at least visually appeared to not differ much by sex:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1">l <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lmer</span>(brainVols <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ns</span>(age,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> Sex <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>subject_id), gf)</span>
<span id="cb33-2">(e <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">emmeans</span>(l, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Sex <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> age, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">at =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span>))))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>age =  7:
 Sex emmean   SE    df lower.CL upper.CL
 F      236 2.65  46.4      231      242
 M      242 2.48  47.1      237      247

age = 21:
 Sex emmean   SE    df lower.CL upper.CL
 F      380 2.75  51.4      374      385
 M      385 2.59  55.0      380      390

age = 65:
 Sex emmean   SE    df lower.CL upper.CL
 F      428 3.58 122.2      421      435
 M      431 3.51 138.1      424      438

Degrees-of-freedom method: kenward-roger 
Confidence level used: 0.95 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pairs</span>(e, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reverse =</span> T)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>age =  7:
 contrast estimate   SE    df t.ratio p.value
 M - F        5.64 3.63  46.7   1.554  0.1269

age = 21:
 contrast estimate   SE    df t.ratio p.value
 M - F        5.53 3.78  53.1   1.462  0.1495

age = 65:
 contrast estimate   SE    df t.ratio p.value
 M - F        2.92 5.01 129.8   0.583  0.5609

Degrees-of-freedom method: kenward-roger </code></pre>
</div>
</div>
<p>And indeed the sex difference in brain volume is relatively uninteresting at those three ages.</p>
<p>Two more digressions with <code>emmeans</code>. First is computing effect sizes, measured as Cohen’s d:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1">l <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lmer</span>(MeA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ns</span>(age,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> Sex <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>subject_id), gf)</span>
<span id="cb37-2">e <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">emmeans</span>(l, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Sex <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> age, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">at =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span>)))</span>
<span id="cb37-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eff_size</span>(e, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sigma</span>(l), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">edf=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>age =  7:
 contrast effect.size    SE    df lower.CL upper.CL
 F - M         -0.496 0.278  56.0    -1.05   0.0612

age = 21:
 contrast effect.size    SE    df lower.CL upper.CL
 F - M         -1.233 0.329  65.2    -1.89  -0.5766

age = 65:
 contrast effect.size    SE    df lower.CL upper.CL
 F - M         -2.179 0.510 172.9    -3.19  -1.1712

sigma used for effect sizes: 0.04366 
Degrees-of-freedom method: inherited from kenward-roger when re-gridding 
Confidence level used: 0.95 </code></pre>
</div>
</div>
<p>A few things to note:</p>
<ol type="1">
<li><p>The effect size function needs the model, the sigma from the linear mixed effects model, and the degrees of freedom of sigma, <code>edf</code>. This latter edf is very hard to define, which comes back to acknowledging that the confidence intervals around these effect sizes are going to be somewhat ill defined. Still useful, but keep that in mind.</p></li>
<li><p>The direction of the effect sizes has reversed again, and there appears to be no <code>reverse=TRUE</code> equivalent to what can be had in <code>pairs</code>.</p></li>
</ol>
<p>One more digression on <code>emmeans</code>. Since the effects are conditional on the model, that means we can evaluate them at any age, not just those where we had scans. This in turn can be useful for visualizing the temporal evolution of your contrast differences. To wit:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(broom)</span>
<span id="cb39-2">e <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">emmeans</span>(l, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Sex <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> age, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">at =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)))</span>
<span id="cb39-3">ef <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eff_size</span>(e, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sigma</span>(l), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">edf=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>)</span>
<span id="cb39-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(ef, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">conf.int =</span> T) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb39-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb39-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>age, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>estimate<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin=</span>conf.low<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax=</span>conf.high<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb39-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_ribbon</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb39-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb39-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb39-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Effect size (male - female)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb39-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Medial Amygdala"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Effect size of sex difference"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://users.ox.ac.uk/~ndcn0890/posts/developmental-data/index_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This shows the effect sizes of sex in the medial amygdala steadily increasing with age. (And note the multiplication by -1 to get the direction to be what we expected. Also note that we are using the <code>tidy</code> function from the <code>broom</code> package to get clean output from <code>emmeans</code>).</p>
</section>
<section id="using-model-comparisons" class="level3">
<h3 class="anchored" data-anchor-id="using-model-comparisons">Using model comparisons</h3>
<p>The downside of the <code>emmeans</code> approach is that one has to, in effect, test multiple different ages, which only makes sense when there are precise hypotheses. An alternate approach is to do a set of model comparisons to get at what we would normally think of as main effects. I.e. how much better does the model fit when we include sex? And do we need an interaction? Let’s test that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1">simpleAgeModel <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lmer</span>(MeA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ns</span>(age, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>subject_id), gf, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">REML =</span> F)</span>
<span id="cb40-2">AgeAndSexModel <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lmer</span>(MeA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ns</span>(age, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Sex <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>subject_id), gf, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">REML =</span> F)</span>
<span id="cb40-3">AgeAndSexInteractionModel  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lmer</span>(MeA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ns</span>(age, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> Sex <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>subject_id), gf, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">REML =</span> F)</span>
<span id="cb40-4"></span>
<span id="cb40-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">anova</span>(simpleAgeModel, AgeAndSexModel, AgeAndSexInteractionModel)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data: gf
Models:
simpleAgeModel: MeA ~ ns(age, 3) + (1 | subject_id)
AgeAndSexModel: MeA ~ ns(age, 3) + Sex + (1 | subject_id)
AgeAndSexInteractionModel: MeA ~ ns(age, 3) * Sex + (1 | subject_id)
                          npar     AIC     BIC logLik deviance  Chisq Df
simpleAgeModel               6 -690.20 -669.73 351.10  -702.20          
AgeAndSexModel               7 -701.50 -677.62 357.75  -715.50 13.305  1
AgeAndSexInteractionModel   10 -717.96 -683.84 368.98  -737.96 22.453  3
                          Pr(&gt;Chisq)    
simpleAgeModel                          
AgeAndSexModel             0.0002647 ***
AgeAndSexInteractionModel  5.251e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Here we set up three different statistical models. The first, <code>simpleAgeModel</code>, has the third order spline for age but no mention of sex. This effectively becomes our null hypothesis - of course the brain will change with development, but it will not do so in any sex specific way. The second model, <code>AgeAndSexModel</code>, includes an additive effect for sex; this would allow for a separate offset by sex, but would keep the slopes between the medial amygdala and age the same for both sexes. The last model <code>AgeAndSexInteractionModel</code>, then also allows the age-relation to vary by sex. Once we’ve computed these three models we run a log-likelihood test between them using the <code>anova</code> function, which produces a chi-squared statistic and its associated p-value.</p>
<p>(Note that we fit all the models with <code>REML=FALSE</code>. This tells <code>lmer</code> to use maximum likelihood, rather than restricted maximum likelihoods as by default. This switch to maximum likelihood estimation is required for the log-likelihood test to be valid when fixed effects are changing between models)</p>
<p>The results show, in looking at the p values, that the AgeAndSex model is better than the simple age model, and that the one with interactions is the best one of all. So for the medial amygdala sex matters and how it matters changes with age.</p>
<p>Let’s retest for overall brain volume where again we should not expect much change:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1">simpleAgeModel <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lmer</span>(brainVols <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ns</span>(age, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>subject_id), gf, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">REML =</span> F)</span>
<span id="cb42-2">AgeAndSexModel <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lmer</span>(brainVols <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ns</span>(age, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Sex <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>subject_id), gf, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">REML =</span> F)</span>
<span id="cb42-3">AgeAndSexInteractionModel  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lmer</span>(brainVols <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ns</span>(age, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> Sex <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>subject_id), gf, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">REML =</span> F)</span>
<span id="cb42-4"></span>
<span id="cb42-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">anova</span>(simpleAgeModel, AgeAndSexModel, AgeAndSexInteractionModel)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data: gf
Models:
simpleAgeModel: brainVols ~ ns(age, 3) + (1 | subject_id)
AgeAndSexModel: brainVols ~ ns(age, 3) + Sex + (1 | subject_id)
AgeAndSexInteractionModel: brainVols ~ ns(age, 3) * Sex + (1 | subject_id)
                          npar    AIC    BIC  logLik deviance  Chisq Df
simpleAgeModel               6 1753.1 1773.6 -870.57   1741.1          
AgeAndSexModel               7 1752.6 1776.5 -869.29   1738.6 2.5620  1
AgeAndSexInteractionModel   10 1758.2 1792.3 -869.08   1738.2 0.4193  3
                          Pr(&gt;Chisq)
simpleAgeModel                      
AgeAndSexModel                0.1095
AgeAndSexInteractionModel     0.9362</code></pre>
</div>
</div>
<p>This once again says that sex does not play much of a role in shaping the overall size of the brain in mice.</p>
<p>That’s enough for now. Computing all these things across brain structures to follow, alongside a discussion of general additive models and segmented models and how to deal with 3 way interactions, and finally some Bayesian fun likely at the end.</p>


</section>

 ]]></description>
  <category>R</category>
  <category>longitudinal</category>
  <guid>https://users.ox.ac.uk/~ndcn0890/posts/developmental-data/index.html</guid>
  <pubDate>Sun, 26 Nov 2023 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Copying important pydpiper outputs</title>
  <dc:creator>Jason Lerch</dc:creator>
  <link>https://users.ox.ac.uk/~ndcn0890/posts/copy-select-files-pydpiper/index.html</link>
  <description><![CDATA[ 




<p>A common scenario is to run a pydpiper pipeline, such as MBM.py, on a cluster, but to want to run the statistical analyses on a different computer. These pipelines can have a pretty hefty disk usage footprint, so it’s not always wise to copy the entire output, but to only get the needed bits. These needed bits are typically:</p>
<ul>
<li><p>the final nonlinear average produced from the data - this will be used to visualize stats maps on</p></li>
<li><p>the atlas labels for the final nonlinear average, also for visualization purposes</p></li>
<li><p>the blurred Jacobian determinants (usually both absolute and relative)</p></li>
<li><p>the atlas labels for each image in the pipeline</p></li>
</ul>
<p>rsync to the rescue. Below are the two rsync commands I use to get just those files described above. In this example, I ran the pipeline on ComputeCanada’s graham cluster, in a folder called <em>myproject</em> on /scratch/jlerch, with the pipeline name as <em>mypipe-2023-10-10</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># first the final non-linear average and it's corresponding atlas labels</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rsync</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-uvrm</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--include</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*/"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--include</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*nlin-3.mnc"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--include</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*voted*"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--exclude</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*"</span> jlerch@graham.computecanada.ca:/scratch</span>
<span id="cb1-3"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/jlerch/myproject/mypipe-2023-10-19_nlin/</span> .</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># next all the processed files, keeping the 0.2mm blurred jacobians</span></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># and the atlas labels per file</span></span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rsync</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-uvr</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--include</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*/"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--include</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*voted*"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--include</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*fwhm0.2.mnc"</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--exclude</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*"</span> jlerch@graham.computecanada.ca:/scratch</span>
<span id="cb1-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">/jlerch/myproject/mypipe-2023-10-19_processed/</span> .</span></code></pre></div>
</div>
<p>The resulting output will keep the directory structure of the pipeline, but only copy the desired few files. Obviously it is easy to modify those commands to also keep, for example, the different resampled files. Lots more help out there on how to tune rsync to your purposes</p>



 ]]></description>
  <category>pydpiper</category>
  <guid>https://users.ox.ac.uk/~ndcn0890/posts/copy-select-files-pydpiper/index.html</guid>
  <pubDate>Wed, 18 Oct 2023 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Better MRIcrotome brain outlines</title>
  <dc:creator>Jason Lerch</dc:creator>
  <link>https://users.ox.ac.uk/~ndcn0890/posts/better-MRIcrotome-outlines/index.html</link>
  <description><![CDATA[ 




<p>Brain outlines are used routinely in MRIcrotome sliceSeries for showing slice locations, plus they can have value in their own right for replacing the full grey-scale background with an outline. By default the outlines take a bit of trial and error to find the right isointensity lines; in some cases no truly good outlines can be generated. Here I will show an alternate way of generating an outline based on having a hierarchical segmentation present.</p>
<section id="setting-up" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="setting-up"><span class="header-section-number">1</span> Setting up</h2>
<p>First we’ll load an existing dataset and generate the hierarchical segmentation representations. For those at Oxford using the BMRC cluster you can follow along, for anyone else you’ll have to substitute your own dataset.</p>
<p>First step, read the information about the scans.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2">gfw2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"exercise-gfw2.csv"</span>)</span></code></pre></div>
</div>
<p>So at this point we have the gf variable containing info about all our files, and gfw2 subsetting them just to the two week timepoint (this is from mice being given access to an exercise wheel).</p>
<p>Next we’ll load the final non-linear average, the segmented final nonlinear average, and build all the volumes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(RMINC)</span>
<span id="cb2-2"></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># read the anatomy and labels </span></span>
<span id="cb2-4">nlin <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mincArray</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mincGetVolume</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/well/lerch/users/yrf023/plasticity/plasticity-2023-03-10_nlin/plasticity-2023-03-10-nlin-3.mnc"</span>))</span>
<span id="cb2-5">labels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mincArray</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mincGetVolume</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/well/lerch/users/yrf023/plasticity/plasticity-2023-03-10_nlin/plasticity-2023-03-10-nlin-3/plasticity-2023-03-10-nlin-3_voted.mnc"</span>))</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get all the volumes</span></span>
<span id="cb2-8">allvolsw2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">anatGetAll</span>(gfw2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>labels, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">defs=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/well/lerch/shared/tools/atlases/Dorr_2008_Steadman_2013_Ullmann_2013/mappings/Dorr_2008_Steadman_2013_Ullmann_2013_mapping_of_labels.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"labels"</span>)</span></code></pre></div>
</div>
<p>And now we put the labelled atlas into it’s hierarchy.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-3_2de3e6f5f15475f960e0aaebc88ead79">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># there's a warning that spews everywhere that needs to be fixed in RMINC, but causes no harm.</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># so for now I'll suppress these warnings</span></span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">suppressWarnings</span>({</span>
<span id="cb3-4">hdefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">makeMICeDefsHierachical</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/well/lerch/shared/tools/atlases/Dorr_2008_Steadman_2013_Ullmann_2013/mappings/Dorr_2008_Steadman_2013_Ullmann_2013_mapping_of_labels.csv"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/well/lerch/shared/tools/atlases/Allen_Brain/Allen_hierarchy_definitions.json"</span>)</span>
<span id="cb3-5">hvolsw2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addVolumesToHierarchy</span>(hdefs, allvolsw2)</span>
<span id="cb3-6">})</span></code></pre></div>
</div>
</section>
<section id="a-basic-example" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="a-basic-example"><span class="header-section-number">2</span> A basic example</h2>
<p>Let’s do a basic example of running a simple linear model, showing it on a brain alongside a slice indicator and legend.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(MRIcrotome)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MRIcrotome'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:graphics':

    legend</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(grid)</span>
<span id="cb7-2"></span>
<span id="cb7-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># a simple linear model against group</span></span>
<span id="cb7-4">vs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mincLm</span>(reljacs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> group, gfw2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mask =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/well/lerch/users/yrf023/plasticity/plasticity-2023-03-10_nlin/plasticity-2023-03-10-nlin-3_mask.mnc"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Method: lm
Number of volumes: 18
Volume sizes: 161 319 210
N: 18 P: 2
In slice 
 0  1  2  3  4  5  6  7  8  9  10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97  98  99  100  101  102  103  104  105  106  107  108  109  110  111  112  113  114  115  116  117  118  119  120  121  122  123  124  125  126  127  128  129  130  131  132  133  134  135  136  137  138  139  140  141  142  143  144  145  146  147  148  149  150  151  152  153  154  155  156  157  158  159  160 
Done</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># show it as a 3 by 3 slice series</span></span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sliceSeries</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">begin=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">anatomy</span>(nlin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">low=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">700</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">high=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1400</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">overlay</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mincArray</span>(vs, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tvalue-grouprunning"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">low=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">high=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">symmetric=</span>T) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t-statistics"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">contourSliceIndicator</span>(nlin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">700</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1400</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">draw</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://users.ox.ac.uk/~ndcn0890/posts/better-MRIcrotome-outlines/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>So that looks roughly right - the slice indicator, at the top right, gives a pretty good idea of where the brain is located. But it’s not great; let’s try a few different contours to see what might look better.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sliceSeries</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">begin=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">anatomy</span>(nlin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">low=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">700</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">high=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1400</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">contours</span>(nlin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">700</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">900</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1400</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"purple"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">draw</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://users.ox.ac.uk/~ndcn0890/posts/better-MRIcrotome-outlines/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Lots of fiddling could be done getting the exact right intensity contours, but it’ll be a challenge to get it just right.</p>
</section>
<section id="contours-based-on-segmentations" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="contours-based-on-segmentations"><span class="header-section-number">3</span> Contours based on segmentations</h2>
<p>So here’s the trick - the perfect outline is inherently in our segmentation. First, let’s view the segmentation</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sliceSeries</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">begin=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">anatomy</span>(nlin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">low=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">700</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">high=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1400</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"anatomy"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sliceSeries</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">anatomy</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">overlay</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hanatToVolume</span>(hvolsw2, labels, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color_hex_triplet"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">low=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">high=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"segmentation"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">draw</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://users.ox.ac.uk/~ndcn0890/posts/better-MRIcrotome-outlines/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now the key part here is that the labels are in a hierarchy. A clean outline could thus be taken if we use just the first parts of that hierarchy:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(data.tree)</span>
<span id="cb12-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create a copy of the hierarchical tree</span></span>
<span id="cb12-3">hdefs2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Clone</span>(hvolsw2)</span>
<span id="cb12-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># and prune it to just the first four levels </span></span>
<span id="cb12-5">hdefs2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Prune</span>(<span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x) x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>level<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 'hdefs2$Prune' is deprecated.
Use 'Prune(node, ...)' instead.
See help("Deprecated")</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 495</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print it to see what it looks like</span></span>
<span id="cb15-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(hdefs2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limit=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                               levelName
1  root2                                                
2   &lt;U+00A6&gt;--Basic cell groups and regions             
3   &lt;U+00A6&gt;   &lt;U+00A6&gt;--Cerebrum                       
4   &lt;U+00A6&gt;   &lt;U+00A6&gt;--Brain stem                     
5   &lt;U+00A6&gt;   &lt;U+00B0&gt;--Cerebellum                     
6   &lt;U+00A6&gt;--fiber tracts                              
7   &lt;U+00A6&gt;   &lt;U+00A6&gt;--cranial nerves                 
8   &lt;U+00A6&gt;   &lt;U+00A6&gt;--medial forebrain bundle system 
9   &lt;U+00A6&gt;   &lt;U+00A6&gt;--cerebellum related fiber tracts
10  &lt;U+00A6&gt;   &lt;U+00A6&gt;--lateral forebrain bundle system
11  &lt;U+00A6&gt;   &lt;U+00B0&gt;--extrapyramidal fiber systems   
12  &lt;U+00B0&gt;--ventricular systems                       
13      &lt;U+00A6&gt;--cerebral aqueduct                     
14      &lt;U+00A6&gt;--fourth ventricle                      
15      &lt;U+00A6&gt;--lateral ventricle                     
16      &lt;U+00B0&gt;--third ventricle                       </code></pre>
</div>
</div>
<p>Now create an outline based on this pruned hierarchy</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sliceSeries</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">begin=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">anatomy</span>(nlin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">low=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">700</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">high=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1400</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sliceSeries</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">anatomy</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">overlay</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hanatToVolume</span>(hvolsw2, labels, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"color_hex_triplet"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">low=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">high=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sliceSeries</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">anatomy</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">contours</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hanatToVolume</span>(hdefs2, labels, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"position"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">draw</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://users.ox.ac.uk/~ndcn0890/posts/better-MRIcrotome-outlines/index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And there you have an almost perfect outline of the brain. So let’s recreate that earlier figure with the cleaner outline:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sliceSeries</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">begin=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">anatomy</span>(nlin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">low=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">700</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">high=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1400</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">overlay</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mincArray</span>(vs, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tvalue-grouprunning"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">low=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">high=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">symmetric=</span>T) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t-statistics"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">contourSliceIndicator</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hanatToVolume</span>(hdefs2, labels, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"position"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">draw</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://users.ox.ac.uk/~ndcn0890/posts/better-MRIcrotome-outlines/index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Voila.</p>


</section>

 ]]></description>
  <category>R</category>
  <category>MRIcrotome</category>
  <category>RMINC</category>
  <guid>https://users.ox.ac.uk/~ndcn0890/posts/better-MRIcrotome-outlines/index.html</guid>
  <pubDate>Fri, 15 Sep 2023 23:00:00 GMT</pubDate>
</item>
<item>
  <title>SCT power analyses</title>
  <dc:creator>Jason Lerch and Kamila Szulc-Lerch</dc:creator>
  <link>https://users.ox.ac.uk/~ndcn0890/posts/sct-power-basic/index.html</link>
  <description><![CDATA[ 




<p>This posts originates from a power analysis needed for a grant application. But it brings with it some potentially interesting methods for conducting power analyses in general alongside some discussion of power in non-orthogonal designs.</p>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>The power analyses here concern the <a href="https://bsd.biomedcentral.com/articles/10.1186/2042-6410-4-15">Sex Chromosome Trisomy (SCT) mouse model</a>, which separates gonadal from chromosomal sex and varies sex chromosome dosage. To do that, the testes forming <em>Sry</em> gene is deleted from the Y chromosome and reinserted onto an autosome, thus allowing one to have XX mice with testes or XY mice with ovaries. In addition, a supernumerary sex chromosome is added, giving one XXY and XYY mice in addition to the XY and XX animals. In the end, there are thus 8 genotypes in the SCT model, as summarized in the table below:</p>
<table class="table">
<thead>
<tr class="header">
<th>Shorthand</th>
<th>Gonads</th>
<th>X dose</th>
<th>Y dose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>XYM</td>
<td>Testes</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>XYF</td>
<td>Ovaries</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>XXM</td>
<td>Testes</td>
<td>2</td>
<td>0</td>
</tr>
<tr class="even">
<td>XXF</td>
<td>Ovaries</td>
<td>2</td>
<td>0</td>
</tr>
<tr class="odd">
<td>XXYM</td>
<td>Testes</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="even">
<td>XXYF</td>
<td>Ovaries</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="odd">
<td>XYYM</td>
<td>Testes</td>
<td>1</td>
<td>2</td>
</tr>
<tr class="even">
<td>XYYF</td>
<td>Ovaries</td>
<td>1</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>There are multiple ways to model this dataset, including testing for effects of 8 genotypes, the effect of aneuploidies, etc. But currently our thinking is that we can model the data as the effect of gonads, X chromosome dose, and Y chromosome dose.</p>
</section>
<section id="setting-up-the-simulations" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-the-simulations">Setting up the simulations</h2>
<p>Let’s set up a function that can simulate this data. First, load some libraries</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(broom)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(splines)</span></code></pre></div>
</details>
</div>
<p>For the sake of this post we’ll keep it simple, and not look for any interactions, and assume that the effects (at least as simulated) are uncorrelated. We’ll also look at what some large effect size (5 sd) simulations would look like to give us a sense of the data.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">generateSCTData <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">npergroup=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, </span>
<span id="cb2-2">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gonadeffectmu=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-3">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gonadeffectsd=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-4">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xeffectmu=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-5">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xeffectsd=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-6">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yeffectmu=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-7">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yeffectsd=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-8">                            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">epsilon=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) {</span>
<span id="cb2-9">  </span>
<span id="cb2-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># generate data from the normal distribution separately for each genotype. Here we just use</span></span>
<span id="cb2-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># epsilon for randomly distributed noise</span></span>
<span id="cb2-12">  groups <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"XYM"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gonad=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">volume=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(npergroup, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, epsilon)),</span>
<span id="cb2-13">                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"XYF"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gonad=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">volume=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(npergroup, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, epsilon)),</span>
<span id="cb2-14">                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"XXM"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gonad=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">volume=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(npergroup, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, epsilon)),</span>
<span id="cb2-15">                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"XXF"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gonad=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">volume=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(npergroup, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, epsilon)),</span>
<span id="cb2-16">                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"XXYM"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gonad=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">volume=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(npergroup, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, epsilon)),</span>
<span id="cb2-17">                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"XXYF"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gonad=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">volume=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(npergroup, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, epsilon)),</span>
<span id="cb2-18">                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"XYYM"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gonad=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">volume=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(npergroup, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, epsilon)),</span>
<span id="cb2-19">                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"XYYF"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gonad=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">volume=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(npergroup, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, epsilon))) </span>
<span id="cb2-20">  </span>
<span id="cb2-21">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># and now we add the effects, again normally distributed (only matters if the sd terms are non-zero)</span></span>
<span id="cb2-22">  groups<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>volume <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> groups<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>volume <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb2-23">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(groups), gonadeffectmu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> groups<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gonad, gonadeffectsd) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb2-24">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(groups), xeffectmu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> groups<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>X, xeffectsd) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb2-25">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(groups), yeffectmu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> groups<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Y, yeffectsd)</span>
<span id="cb2-26">    </span>
<span id="cb2-27">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># and return the dataset</span></span>
<span id="cb2-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(groups <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb2-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gonadeffectmu=</span>gonadeffectmu,</span>
<span id="cb2-30">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xeffectmu=</span>xeffectmu,</span>
<span id="cb2-31">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yeffectmu=</span>yeffectmu</span>
<span id="cb2-32">  ))</span>
<span id="cb2-33">  </span>
<span id="cb2-34">} </span>
<span id="cb2-35"></span>
<span id="cb2-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># now generate three datasets with large effects</span></span>
<span id="cb2-37">SCTg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">generateSCTData</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gonadeffectmu =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sim=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Beta gonads = 5"</span>)</span>
<span id="cb2-38">SCTx <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">generateSCTData</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xeffectmu =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sim=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Beta X = 5"</span>)</span>
<span id="cb2-39">SCTy <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">generateSCTData</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yeffectmu =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sim=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Beta Y = 5"</span>)</span>
<span id="cb2-40"></span>
<span id="cb2-41"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(SCTg, SCTx, SCTy) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-42">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb2-43">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>group, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>volume) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb2-44">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_boxplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-45">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(.<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>sim) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb2-46">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-47">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) </span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://users.ox.ac.uk/~ndcn0890/posts/sct-power-basic/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This makes a few points that come out of the model. Gonads are fully balanced, but chromosome dosage is not. There are two possible levels of X (1 and 2), and three of Y (0, 1, and 2). And there is some correlation between them</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">generateSCTData</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">npergroup =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>X, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Y) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_tile</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X dose"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y dose"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb3-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://users.ox.ac.uk/~ndcn0890/posts/sct-power-basic/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The design is not fully orthogonal - you cannot have an X dose of 1 and Y dose of 0, or and X dose of 2, and Y of 2.</p>
</section>
<section id="sct-power" class="level2">
<h2 class="anchored" data-anchor-id="sct-power">SCT power</h2>
<p>What does the SCT model’s non-orthogonal design do to our power? Let’s see - we’ll run a set of simulations. It’ll be relatively straightforward:</p>
<ol type="1">
<li>for 500 simulations
<ol type="1">
<li><p>for effect sizes ranging from 0 to 1.5 with steps of 0.1</p>
<ol type="1">
<li>simulate an SCT dataset of 10 subjects per genotype with one of the three terms (genotype, X dose, Y dose) varying by the effect size</li>
<li>model it with y ~ gonads + Xdose + Ydose</li>
<li>assess the number of the simulations where p &lt; 0.05</li>
</ol></li>
</ol></li>
</ol>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-4_859f587726a2e59d73e55f9e3bc1c1df">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">generateSCTSimSeries <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nsims=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>,</span>
<span id="cb4-2">                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">npergroup=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb4-3">                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gonadeffectmu=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb4-4">                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xeffectmu=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb4-5">                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yeffectmu=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb4-6">                                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">epsilon=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>){</span>
<span id="cb4-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># make sure that effects are all equal</span></span>
<span id="cb4-8">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(gonadeffectmu) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(xeffectmu) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> </span>
<span id="cb4-9">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(gonadeffectmu) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(yeffectmu)) {</span>
<span id="cb4-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stop</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Effects must be the same length"</span>)</span>
<span id="cb4-11">  }</span>
<span id="cb4-12">  </span>
<span id="cb4-13">  neffects <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(gonadeffectmu)</span>
<span id="cb4-14">  </span>
<span id="cb4-15">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># and now we run the simulations</span></span>
<span id="cb4-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">npergroup=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(npergroup, neffects<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>nsims), </span>
<span id="cb4-17">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gonadeffectmu=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(gonadeffectmu, nsims), </span>
<span id="cb4-18">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xeffectmu=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(xeffectmu, nsims), </span>
<span id="cb4-19">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yeffectmu=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(yeffectmu, nsims),</span>
<span id="cb4-20">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">epsilon=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(epsilon, neffects<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>nsims)),</span>
<span id="cb4-21">                  generateSCTData))</span>
<span id="cb4-22"></span>
<span id="cb4-23">}</span>
<span id="cb4-24"></span>
<span id="cb4-25">modelSCTSimSeries <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(df) {</span>
<span id="cb4-26">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#df &lt;- df %&gt;% mutate(X = X-1)</span></span>
<span id="cb4-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tidy</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(volume <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> gonad <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Y, df)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gonadeffectmu=</span>df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gonadeffectmu[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],</span>
<span id="cb4-28">                                                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xeffectmu=</span>df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>xeffectmu[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],</span>
<span id="cb4-29">                                                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yeffectmu=</span>df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>yeffectmu[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-30">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> term, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> estimate<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>p.value)</span>
<span id="cb4-31">}</span>
<span id="cb4-32"></span>
<span id="cb4-33">makePowerSeries <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>() {</span>
<span id="cb4-34">  effectseries <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)</span>
<span id="cb4-35">  neffects <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(effectseries)</span>
<span id="cb4-36">  npergroup<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb4-37">  nsims<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span></span>
<span id="cb4-38">  </span>
<span id="cb4-39">  Gseries <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">generateSCTSimSeries</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nsims=</span>nsims, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">npergroup =</span> npergroup,</span>
<span id="cb4-40">                                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xeffect=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, neffects), </span>
<span id="cb4-41">                                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yeffectmu =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, neffects), </span>
<span id="cb4-42">                                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gonadeffectmu =</span> effectseries) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-43">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dfr</span>(modelSCTSimSeries) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delta=</span>gonadeffectmu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span>p.value_gonad)</span>
<span id="cb4-44">  Xseries <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">generateSCTSimSeries</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nsims=</span>nsims, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">npergroup =</span> npergroup,</span>
<span id="cb4-45">                                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gonadeffect=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, neffects), </span>
<span id="cb4-46">                                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yeffectmu =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, neffects), </span>
<span id="cb4-47">                                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xeffectmu =</span> effectseries) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-48">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dfr</span>(modelSCTSimSeries) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delta=</span>xeffectmu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span>p.value_X)</span>
<span id="cb4-49">  Yseries <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">generateSCTSimSeries</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nsims=</span>nsims, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">npergroup =</span> npergroup,</span>
<span id="cb4-50">                                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xeffect=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, neffects), </span>
<span id="cb4-51">                                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gonadeffectmu =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, neffects), </span>
<span id="cb4-52">                                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yeffectmu =</span> effectseries) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-53">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dfr</span>(modelSCTSimSeries) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delta=</span>yeffectmu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p=</span>p.value_Y)</span>
<span id="cb4-54">  </span>
<span id="cb4-55">  allseries <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(Gseries, Xseries, Yseries)</span>
<span id="cb4-56">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(allseries)</span>
<span id="cb4-57">}</span>
<span id="cb4-58"></span>
<span id="cb4-59">fullseries <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">makePowerSeries</span>()</span></code></pre></div>
</details>
</div>
<p>Let’s see what this looks like:</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">fullseries <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(yeffectmu, xeffectmu, gonadeffectmu) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">power=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(p<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(yeffectmu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>gonadeffectmu) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>power, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour=</span>name) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se=</span>F, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula=</span>y<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ns</span>(x,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bquote</span>(delta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> (effect <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> size))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">limits=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_brewer</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Model term"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gonad"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X dose"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y dose"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Set1"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://users.ox.ac.uk/~ndcn0890/posts/sct-power-basic/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here power - the proportion of simulations where p was &lt; 0.05 - is on the y axis, and the simulated effect size on the x axis. So, for example, to get a power of 0.08 you’d need to an effect size of about 0.6 for gonads and Y dose and 0.9 for X dose.</p>
</section>
<section id="why-is-x-dose-less-powered-than-y-or-gonads" class="level2">
<h2 class="anchored" data-anchor-id="why-is-x-dose-less-powered-than-y-or-gonads">Why is X dose less powered than Y or gonads?</h2>
<p>What’s up with the previous results? Why is X dose at a lower power than Y or gonads?</p>
<p>Let’s start with gonads and test whether our simulations make sense. We simulated 10 mice per group, so given that exactly half the mice will be of each gonad type we can assess whether we’d get the same answer with a parametric power test:</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">power.t.test</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">power=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample t test power calculation 

              n = 40
          delta = 0.634299
             sd = 1
      sig.level = 0.05
          power = 0.8
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
<p>And indeed, the answer is the same - at 40 mice per group and a power of 0.8 you’d recapture an effect size of 0.63.</p>
<p>But you also have 40 mice with one X chromosome and 40 mice with 2 X chromosomes, yet the power is lower than expected. The answer lies in the fact that the two are correlated:</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">generateSCTData</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">npergroup =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(gonad, X, Y) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> cor</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      gonad          X          Y
gonad     1  0.0000000  0.0000000
X         0  1.0000000 -0.7071068
Y         0 -0.7071068  1.0000000</code></pre>
</div>
</div>
<p>Now go and have a read of <a href="https://cdr.lib.unc.edu/downloads/028715161">this paper from 1991</a>. Estimated errors in linear models are both dependent on the covariance between terms as well as the range of possible values. So X and Y doses are correlated, but Y dose has a greater range, hence the greater power for Y dose than X dose in the SCT model.</p>
</section>
<section id="the-dangers-of-model-misspecification" class="level2">
<h2 class="anchored" data-anchor-id="the-dangers-of-model-misspecification">The dangers of model misspecification</h2>
<p>So if there is a problem with colinearity why don’t we run a separate model with just or X or Y dose? Let’s try that for a single simulation of an effect size of 2 for X</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span>
<span id="cb10-2">Xsim <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">generateSCTData</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xeffectmu =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
</details>
</div>
<p>And let’s look at the output of our linear model including all terms:</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(volume <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> gonad <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Y, Xsim))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = volume ~ gonad + X + Y, data = Xsim)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.71496 -0.56202  0.06254  0.65473  2.37194 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.01185    0.71272  -0.017   0.9868    
gonad        0.40373    0.23757   1.699   0.0933 .  
X            1.80717    0.33598   5.379 7.99e-07 ***
Y            0.11938    0.23757   0.503   0.6168    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.062 on 76 degrees of freedom
Multiple R-squared:  0.4136,    Adjusted R-squared:  0.3905 
F-statistic: 17.87 on 3 and 76 DF,  p-value: 7.13e-09</code></pre>
</div>
</div>
<p>Looks reasonably good in terms of both effect size and significance for both X and Y. But now let’s just model X.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(volume <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> X, Xsim))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = volume ~ X, data = Xsim)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.8571 -0.6050  0.1795  0.6668  2.1104 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   0.4885     0.3784   1.291    0.201    
X             1.6878     0.2393   7.053 6.25e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.07 on 78 degrees of freedom
Multiple R-squared:  0.3894,    Adjusted R-squared:  0.3816 
F-statistic: 49.74 on 1 and 78 DF,  p-value: 6.247e-10</code></pre>
</div>
</div>
<p>The estimate is a bit lower, but still not too far off. But let’s model Y for data where only a change in X was simulated:</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(volume <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Y, Xsim))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = volume ~ Y, data = Xsim)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.6766 -0.8249  0.2119  0.9249  2.5556 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   3.8044     0.2419   15.73  &lt; 2e-16 ***
Y            -0.7842     0.1975   -3.97 0.000159 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.249 on 78 degrees of freedom
Multiple R-squared:  0.1681,    Adjusted R-squared:  0.1575 
F-statistic: 15.76 on 1 and 78 DF,  p-value: 0.0001585</code></pre>
</div>
</div>
<p>A woefully incorrect estimate. In the presence of colinearity you need to covary for the other parameters to not get caught in a badly misspecified model.</p>


</section>

 ]]></description>
  <category>R</category>
  <guid>https://users.ox.ac.uk/~ndcn0890/posts/sct-power-basic/index.html</guid>
  <pubDate>Tue, 05 Sep 2023 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Annotated MBM command</title>
  <dc:creator>Jason Lerch</dc:creator>
  <link>https://users.ox.ac.uk/~ndcn0890/posts/MBM-command-illustrated/index.html</link>
  <description><![CDATA[ 




<p>There is little good documentation of the different pydpiper pipelines, unfortunately. Here I will take a baby-step to remedying that in providing an annotated command for a pipeline I recently ran. This will hopefully provide at least some level of insight into all them thar options.</p>
<p>Here’s the command, run on a set of test-data from Yingshi:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-1" style="background: #f1f3f5;"><pre class="sourceCode bash code-annotation-code code-with-copy code-annotated"><code class="sourceCode bash"><a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-1-1" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SE</span> MBM.py <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-1-2" class="code-annotation-target">--backend=makeflow <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-1-3" class="code-annotation-target">--makeflow-opts=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'-h'</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-1-4" class="code-annotation-target">--pipeline-name Yingshi-T2w-2023-08-11 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-1-5" class="code-annotation-target">--subject-matter mousebrain <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-1-6" class="code-annotation-target">--init-model /well/lerch/shared/tools/initial-models/oxford-model-2023/oxford_t2w_mouse_60micron.mnc <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="7" onclick="event.preventDefault();">7</a><span id="annotated-cell-1-7" class="code-annotation-target">--lsq6-simple <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="8" onclick="event.preventDefault();">8</a><span id="annotated-cell-1-8" class="code-annotation-target">--lsq12-protocol /well/lerch/shared/tools/protocols/linear/Pydpiper_testing_default_lsq12.csv <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="9" onclick="event.preventDefault();">9</a><span id="annotated-cell-1-9" class="code-annotation-target">--run-maget <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="10" onclick="event.preventDefault();">10</a><span id="annotated-cell-1-10" class="code-annotation-target">--maget-registration-method minctracc <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="11" onclick="event.preventDefault();">11</a><span id="annotated-cell-1-11" class="code-annotation-target">--maget-atlas-library /well/lerch/shared/tools/atlases/Dorr_2008_Steadman_2013_Ullmann_2013_Richards_2011_Qiu_2016_Egan_2015_40micron/ex-vivo/ <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="12" onclick="event.preventDefault();">12</a><span id="annotated-cell-1-12" class="code-annotation-target">--maget-nlin-protocol /well/lerch/shared/tools/protocols/nonlinear/default_nlin_MAGeT_minctracc_prot.csv <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<span id="annotated-cell-1-13">--maget-masking-nlin-protocol /well/lerch/shared/tools/protocols/nonlinear/default_nlin_MAGeT_minctracc_prot.csv <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="13" onclick="event.preventDefault();">13</a><span id="annotated-cell-1-14" class="code-annotation-target">--no-common-space-registration <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="14" onclick="event.preventDefault();">14</a><span id="annotated-cell-1-15" class="code-annotation-target">--num-executors 1 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="15" onclick="event.preventDefault();">15</a><span id="annotated-cell-1-16" class="code-annotation-target">--files /well/lerch/users/yrf023/Yingshi-tests/native/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>removed.mnc</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-annotation="1" data-code-lines="1" data-code-cell="annotated-cell-1">The command itself. The SE prefix here is an alias to running the command in a singularity container (see <a href="../../posts/minc-on-bmrc/index.html">here</a>)</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-annotation="2" data-code-lines="2" data-code-cell="annotated-cell-1">The backend. There are two options; the default (i.e.&nbsp;if you do not specify a backend), which is our own server-executor mode based on pyro (python remote objects). Here I am using <a href="https://cctools.readthedocs.io/en/latest/makeflow/">makeflow</a>, in which case pydpiper will output a makeflow file which can then be processed separately using the different makeflow tools.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="3">3</dt>
<dd>
<span data-code-annotation="3" data-code-lines="3" data-code-cell="annotated-cell-1">This is only relevant when using the makeflow backend, and is a workaround to stop pydpiper from trying to run makeflow itself. Should be fixed (i.e.&nbsp;no longer necessary) in a future version of pydpiper.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="4">4</dt>
<dd>
<span data-code-annotation="4" data-code-lines="4" data-code-cell="annotated-cell-1">The pipeline name - one of the required arguments. All output files and directories will have this name as its prefix, so it has to be unique within the directory from which the MBM command is being run.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="5">5</dt>
<dd>
<span data-code-annotation="5" data-code-lines="5" data-code-cell="annotated-cell-1">The subject matter - when set to <em>mousebrain</em> it will use a few defaults sensible for rodents (i.e.&nbsp;works for rats too) for some of the registration steps.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="6">6</dt>
<dd>
<span data-code-annotation="6" data-code-lines="6" data-code-cell="annotated-cell-1">The initial model - one of the key parameters for a successful registration, described in more detail below, see Section&nbsp;1.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="7">7</dt>
<dd>
<span data-code-annotation="7" data-code-lines="7" data-code-cell="annotated-cell-1">How to run the initial 6 parameter (rigid body) alignment; also key for a successful registration, described in more detail in Section&nbsp;2.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="8">8</dt>
<dd>
<span data-code-annotation="8" data-code-lines="8" data-code-cell="annotated-cell-1">Here I’m over-riding the default parameters for the 12 parameter registration, with those parameters specified in the text file following the argument. A full description of how to craft those files will be the subject of a future post.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="9">9</dt>
<dd>
<span data-code-annotation="9" data-code-lines="9" data-code-cell="annotated-cell-1">We tell pydpiper to use MAGeT, our multi-atlas registration pipeline, to also segment the brains.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="10">10</dt>
<dd>
<span data-code-annotation="10" data-code-lines="10" data-code-cell="annotated-cell-1">We specify to use minctracc (rather than ANTS) for the MAGeT registrations. In a prior study we found that ANTS had better formed jacobians, and was thus preferable for the voxel based analyses and is thus the registration engine we use for most pydpiper registrations, but that minctracc created slightly more accurate segmentations and was a decent bit faster, hence we usually use it for the segmentation pipelines.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="11">11</dt>
<dd>
<span data-code-annotation="11" data-code-lines="11" data-code-cell="annotated-cell-1">We tell MAGeT to use a particular segmented atlas library, here the DSURQE atlas. Full description of the different atlases will be the subject of a future post.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="12">12</dt>
<dd>
<span data-code-annotation="12" data-code-lines="12,13" data-code-cell="annotated-cell-1">Next are two more options for specifying the parameters, described in the text files following the arguments, to control how to run the MAGeT registrations.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="13">13</dt>
<dd>
<span data-code-annotation="13" data-code-lines="14" data-code-cell="annotated-cell-1">There is an optional step to align the final study-specific template to a common space shared across different registrations. Here we turn that off.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="14">14</dt>
<dd>
<span data-code-annotation="14" data-code-lines="15" data-code-cell="annotated-cell-1">We tell pydpiper to only use a single executor - this option only becomes relevant if we want pydpiper to execute commands itself, but since we opted to output a makeflow file instead and will execute the pipeline via makeflow, we switch this to a single executor.</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="15">15</dt>
<dd>
<span data-code-annotation="15" data-code-lines="16" data-code-cell="annotated-cell-1">And lastly we specify the MINC files that go into the pipeline run itself. Obviously a crucial argument.</span>
</dd>
</dl>
</div>
</div>
<p>There are many more options than this - to see them all, run MBM –help.</p>
<p>The next step in this pipeline would then be to use makeflow to run the commands; see <a href="../../posts/minc-on-bmrc/index.html">an example for running a pipeline on the BMRC cluster</a>.</p>
<section id="sec-init" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="sec-init"><span class="header-section-number">1</span> Initial models</h2>
<p>Most parameters to pydpiper pipelines can remain unchanged no matter whether the input is mouse or rat, in-vivo or ex-vivo. But initial models are different - they have to be matched to your data for the registration to work. I’ll cover how to create an initial model from scratch in a future post. In the meantime, here are the most used models at MICe and Oxford:</p>
<table class="table">
<colgroup>
<col style="width: 52%">
<col style="width: 16%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Modality</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>oxford-model-2023/oxford_t2w_mouse_60micron.mnc</td>
<td>in-vivo mouse</td>
<td>Use for Oxford MEMRI scans.</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="sec-lsq6" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="sec-lsq6"><span class="header-section-number">2</span> LSQ6 choices</h2>
<p>In my experience, the initial rigid body alignment stage is the one most likely to fail. I rarely ever change the lsq12 or nlin parameters, but when faced with new data I routinely modify the initial model and switch between lsq6 modes. There are three lsq6 modes built into pydpiper pipelines.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 93%">
</colgroup>
<thead>
<tr class="header">
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>--lsq6-simple</td>
<td>Assumes that the initial model and the native files are in the same space. I use this for in-vivo data from the Oxford scanner, where there is a single coil and the positioning of the mice in the scanner is fairly consistent.</td>
</tr>
<tr class="even">
<td>--lsq6-centre-estimation</td>
<td>Assumes that the initial model and the native files are oriented the same way, but estimates a centre-of-gravity based translation. This can work for the MICe in-vivo setup, where the orientation is well controlled but due to the multiple coils the start coordinates differ dependent on coils.</td>
</tr>
<tr class="odd">
<td>--lsq6-large-rotations</td>
<td>Neither the orientation nor the start coordinates are assumed to be the same. This option is essential for ex-vivo samples scanned in Toronto, especially for embryos where it is challenging to control the rotation of the sample precisely. There are two further options that control the search space: --lsq6-rotational-range and --lsq6-rotational-interval.</td>
</tr>
</tbody>
</table>


</section>

 ]]></description>
  <category>pydpiper</category>
  <guid>https://users.ox.ac.uk/~ndcn0890/posts/MBM-command-illustrated/index.html</guid>
  <pubDate>Fri, 01 Sep 2023 23:00:00 GMT</pubDate>
</item>
<item>
  <title>MINC tools on BMRC cluster</title>
  <dc:creator>Jason Lerch</dc:creator>
  <link>https://users.ox.ac.uk/~ndcn0890/posts/minc-on-bmrc/index.html</link>
  <description><![CDATA[ 




<p>Some bits and pieces on how to run the different MINC tools related to mouse imaging pipelines, prominently pydpiper, the viz tools, and RMINC, on Oxford’s BMRC cluster.</p>
<section id="some-bmrc-basics" class="level2">
<h2 class="anchored" data-anchor-id="some-bmrc-basics">Some BMRC basics</h2>
<p>The BMRC cluster login is described <a href="https://www.medsci.ox.ac.uk/for-staff/resources/bmrc/cluster-login">here</a>. You obviously need an account first; how to request one is described <a href="https://www.win.ox.ac.uk/research/it/i-want-to/obtaining/win-bmrc">here</a>. Once you have an account an additional way to access BMRC is via the <a href="https://www.win.ox.ac.uk/research/it/i-want-to/wfh/remote-desktops/bmrc-remote-desktops/bmrc-open-ondemand">Open OnDemand interface</a>, which is what I use for most tasks and will be important for visualization and RStudio.</p>
<p>Three notes about what data is allowed on the BMRC cluster 1. Rodent MRI data is fine 2. Rodent video tracking data has to get approval first - so contact them before trying deeplabcut, for example. 3. Human MRI data, even if from an open dataset, has a somewhat onerous approval process in place as well before it is allowed.</p>
</section>
<section id="using-minc-tools-via-the-singularity-container" class="level2">
<h2 class="anchored" data-anchor-id="using-minc-tools-via-the-singularity-container">Using MINC tools via the singularity container</h2>
<p>Once you have a shell open, there are two ways to access the MINC tools. For the majority of uses you’ll want to access them via our singularity container, located here: /well/lerch/shared/tools/mice.sif_latest.sif</p>
<p>All the main MINC tools are there, to be accessed like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">export</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">APPTAINER_BIND</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>/well/</span>
<span id="cb1-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">apptainer</span> exec /well/lerch/shared/tools/mice.sif_latest.sif mincinfo file.mnc</span></code></pre></div>
</div>
<p>I often set an alias to make life a bit easier:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">alias</span> SE=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'apptainer exec /well/lerch/shared/tools/mice.sif_latest.sif'</span></span></code></pre></div>
</div>
<p>And then the commands can be accessed more simply</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SE</span> mincinfo file.mnc</span></code></pre></div>
</div>
</section>
<section id="using-rminc-on-bmrc" class="level2">
<h2 class="anchored" data-anchor-id="using-rminc-on-bmrc">Using RMINC on BMRC</h2>
<p>You can use RMINC via the container, though with the disadvantage of currently (this will be fixed once I find a bit of time) using the older R 3.6. More importantly, it’s more challenging to access the cluster queues from within the container. So R and RMINC can also be accessed via bare metal.</p>
<p>To launch RStudio, start an <a href="https://www.win.ox.ac.uk/research/it/i-want-to/wfh/remote-desktops/bmrc-remote-desktops/bmrc-open-ondemand">Open OnDemand session</a>. Then, when prompted with this screen</p>
<p><img src="https://users.ox.ac.uk/~ndcn0890/posts/minc-on-bmrc/Screenshot 2023-09-05 at 2.50.37 PM.png" class="img-fluid"></p>
<p>Choose RStudio. This will give some choices, like so:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://users.ox.ac.uk/~ndcn0890/posts/minc-on-bmrc/Screenshot 2023-09-05 at 2.47.51 PM.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Notice two changes from the default here:</figcaption>
</figure>
</div>
<ol type="1">
<li>Select “WIN” from the partition; not strictly necessary, but there are usually available cores with lots of RAM here</li>
<li>Change the “RAM in Gb”, the default is 4Gb, which won’t be enough. Go for 32 or even higher if you know you need lots of RAM.</li>
</ol>
<p>At this point you’ll have an RStudio session in your web browser, running on a node on the BMRC cluster. Which is sweet.</p>
<p>To get RMINC working, you’ll need to do this once (i.e.&nbsp;only the first time you start an RStudio session).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">usethis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">edit_r_profile</span>()</span></code></pre></div>
</div>
<p>This will open your R profile in the editor window. Enter these lines:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.libPaths</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/well/lerch/shared/tools/packages/RMINC/build/"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.libPaths</span>()))</span></code></pre></div>
</div>
<p>This will make sure that RMINC and MRIcrotome, as well as a few other packages that I’ve installed, are loadable.</p>
</section>
<section id="running-pydpiper-on-bmrc" class="level2">
<h2 class="anchored" data-anchor-id="running-pydpiper-on-bmrc">Running pydpiper on BMRC</h2>
<p>There are three steps to running a pydpiper pipeline on the BMRC cluster</p>
<ol type="1">
<li>Generate a makeflow file using one of the pydpiper pipelines, such as MBM.py</li>
<li>Fix a time allocation bug</li>
<li>Use makeflow to run the pipeline</li>
</ol>
<p>Here’s an example of generating the makeflow file. See <a href="../../posts/MBM-command-illustrated/index.html">here</a> for an annotation of what all the options are doing. Key here is setting the backend to be ‘makeflow’</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">SE</span> MBM.py <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--backend</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>makeflow <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--makeflow-opts</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'-h'</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--pipeline-name</span> Yingshi-T2w-2023-08-11 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--maget-registration-method</span> minctracc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--subject-matter</span> mousebrain <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--init-model</span> /well/lerch/shared/tools/initial-models/oxford-model-2023/oxford_t2w_mouse_60micron.mnc <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--run-maget</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--maget-atlas-library</span> /well/lerch/shared/tools/atlases/Dorr_2008_Steadman_2013_Ullmann_2013_Richards_2011_Qiu_2016_Egan_2015_40micron/ex-vivo/ <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--maget-nlin-protocol</span> /well/lerch/shared/tools/protocols/nonlinear/default_nlin_MAGeT_minctracc_prot.csv <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--maget-masking-nlin-protocol</span> /well/lerch/shared/tools/protocols/nonlinear/default_nlin_MAGeT_minctracc_prot.csv <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--lsq12-protocol</span> /well/lerch/shared/tools/protocols/linear/Pydpiper_testing_default_lsq12.csv <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--no-common-space-registration</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--lsq6-simple</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--num-executors</span> 1 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">--files</span> /well/lerch/users/yrf023/Yingshi-tests/native/<span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">*</span>removed.mnc</span></code></pre></div>
</div>
<p>Next we fix the time variable. In short, pydpiper sets the default time for some registrations to be 48 hours. Unfortunately, this cannot be overwritten with command arguments at this point. (When I have some time I’ll fix that). But since the makeflow file is just a text file, we can just do a string substitution to change it to 24 hours</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span> Yingshi-T2w-2023-08-11_makeflow.jx <span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">|</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">perl</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-npe</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'s/"wall-time"\: 172800/"wall-time": 86400/'</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> Yingshi-T2w-2023-08-11_makeflow_fixed.jx</span></code></pre></div>
</div>
<p>Now that we have a fixed up makeflow file, we can run it with makeflow itself. Right now makeflow is installed as a conda environment. Before the first run, edit your ~/.condarc file to contain the following bits:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">channels:</span></span>
<span id="cb8-2">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> conda-forge</span>
<span id="cb8-3">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> bioconda</span>
<span id="cb8-4">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> defaults</span>
<span id="cb8-5"> </span>
<span id="cb8-6"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">pkgs_dirs:</span></span>
<span id="cb8-7">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> /well/lerch/shared/conda/<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${MODULE_CPU_TYPE}</span>/pkgs</span>
<span id="cb8-8"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">envs_dirs:</span></span>
<span id="cb8-9">  <span class="ex" style="color: null;
background-color: null;
font-style: inherit;">-</span> /well/lerch/shared/conda/<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">${MODULE_CPU_TYPE}</span>/envs</span></code></pre></div>
</div>
<p>See <a href="https://www.medsci.ox.ac.uk/for-staff/resources/bmrc/python-on-the-bmrc-cluster#conda--anaconda-and-miniconda">here</a> for more details.</p>
<p>Assuming that the ~/.condarc file is correct, you can now set your environment for running conda.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># and run via makeflow</span></span>
<span id="cb9-2"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">module</span> load Anaconda3/2022.05</span>
<span id="cb9-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">eval</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$(</span><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">conda</span> shell.bash hook<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">)</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb9-4"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">conda</span> activate cctools-env</span></code></pre></div>
</div>
<p>Now you can run makeflow itself:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-10" style="background: #f1f3f5;"><pre class="sourceCode bash code-annotation-code code-with-copy code-annotated"><code class="sourceCode bash"><a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-10-1" class="code-annotation-target"><span class="ex" style="color: null;
background-color: null;
font-style: inherit;">makeflow</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-T</span> slurm <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-10-2" class="code-annotation-target">-B <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'-p short,win'</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-10-3" class="code-annotation-target">--max-remote=500 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-10-4" class="code-annotation-target">-o stderr.log <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-10-5" class="code-annotation-target">--shared-fs=/well,/gpfs3 <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-10-6" class="code-annotation-target">--singularity=/well/lerch/shared/tools/mice.sif_latest.sif <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="7" onclick="event.preventDefault();">7</a><span id="annotated-cell-10-7" class="code-annotation-target">--singularity-opt=<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'--bind=/well,/gpfs3'</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">\</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="8" onclick="event.preventDefault();">8</a><span id="annotated-cell-10-8" class="code-annotation-target">--jx Yingshi-T2w-2023-08-11_makeflow_fixed.jx</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-10" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="1" data-code-annotation="1">We tell makeflow to use the slurm backend, which is what BMRC uses.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="2" data-code-annotation="2">We tell it to use both the short and win queues</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="3" data-code-annotation="3">We allow up to 500 jobs to be submitted at once.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="4" data-code-annotation="4">We capture some errors to stderr.log</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="5" data-code-annotation="5">We need to tell it which filesystems are shared.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="6" data-code-annotation="6">We need to tell it run the commands itself inside the container.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="7" data-code-annotation="7">We need to tell the container which filesystems to bind.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="8" data-code-annotation="8">And finally we pass it the fixed makeflow file.</span>
</dd>
</dl>
</div>
</div>
<p>That’s it - it will now run for a good while. I would thus recommend you run it inside a <a href="https://www.hamvocke.com/blog/a-quick-and-easy-guide-to-tmux/">tmux</a> session, so that you can log out and come back later to check on progress (or won’t lose progress if you get disconnected).</p>
<p>A good way to check on the status of the pipeline is to look at the makeflowlog file that will be produced as the pipeline runs, or use ‘squeue –me’ to see which jobs are submitted to the cluster.</p>
<p>(Also note, there should be a better way to run these pipelines via makeflow’s workqueue, but last I tried I couldn’t get it to run. Will return to that at some point.)</p>


</section>

 ]]></description>
  <category>Oxford</category>
  <guid>https://users.ox.ac.uk/~ndcn0890/posts/minc-on-bmrc/index.html</guid>
  <pubDate>Mon, 28 Aug 2023 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Welcome</title>
  <dc:creator>Jason Lerch</dc:creator>
  <link>https://users.ox.ac.uk/~ndcn0890/posts/welcome/index.html</link>
  <description><![CDATA[ 




<p>Welcome to this blog, which is mostly motivated by the poor state of documentation around various mouse brain imaging analysis tools, in particular the <a href="https://github.com/Mouse-Imaging-Centre/pydpiper">pydpiper</a> pipelines and <a href="https://github.com/Mouse-Imaging-Centre/RMINC">RMINC</a>. So, rather than create a proper documentation website, here I will collect notes on different analyses and make them accessible for anyone else who might benefit. And who knows, the posts will likely expand to random stats topics and digressions in neuroscience.</p>
<section id="how-to-contribute" class="level2">
<h2 class="anchored" data-anchor-id="how-to-contribute">How to contribute</h2>
<p>Contributions are very much welcome! Next time you start a new analysis for which you take notes for yourself anyway, why not turn them into a blog post? The best way is to clone the repository for this blog (it’s in the <a href="https://quarto.org/docs/websites/website-blog.html">quarto blog</a> format), create a new post, and then <a href="https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request">make a pull request via github</a>, and then I’ll add it to the blog. The repo for this repository is <a href="https://github.com/jasonlerch/blog">here</a>.</p>


</section>

 ]]></description>
  <category>news</category>
  <guid>https://users.ox.ac.uk/~ndcn0890/posts/welcome/index.html</guid>
  <pubDate>Mon, 28 Aug 2023 23:00:00 GMT</pubDate>
</item>
</channel>
</rss>
